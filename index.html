<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RipFit / FutureBody 3.0 Anatomical Edition</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
  margin: 0;
  font-family: Poppins, sans-serif;
  background: radial-gradient(circle at center, #0a0a0a 0%, #000 100%);
  color: #fff;
  text-align: center;
  overflow-x: hidden;
}
h1 {
  color: #00eaff;
  text-shadow: 0 0 10px #00eaff;
}
.container {
  max-width: 900px;
  margin: auto;
  padding: 15px;
}
#energyBarContainer {
  width: 80%;
  background: #222;
  border-radius: 20px;
  margin: 10px auto;
  height: 20px;
  position: relative;
  overflow: hidden;
}
#energyBar {
  height: 100%;
  width: 60%;
  background: linear-gradient(90deg, #00ff88, #00eaff);
  transition: width 0.3s;
}
#snack {
  position: absolute;
  right: -40px;
  top: -2px;
  cursor: pointer;
  font-size: 24px;
}
#avatarContainer {
  position: relative;
  display: inline-block;
}
#avatar {
  width: 300px;
  display: block;
  margin: 20px auto;
  border-radius: 10px;
}
.area {
  position: absolute;
  cursor: pointer;
  border-radius: 50%;
  opacity: 0.15;
  background-color: green;
  transition: all 0.3s ease;
}
button {
  background: linear-gradient(90deg, #ff0080, #7928ca);
  color: #fff;
  border: none;
  padding: 6px 14px;
  border-radius: 25px;
  font-weight: 600;
  margin: 4px;
  cursor: pointer;
}
#popup {
  position: absolute;
  background: rgba(10, 10, 10, 0.95);
  border: 1px solid #00eaff;
  border-radius: 10px;
  padding: 10px;
  display: none;
  z-index: 10;
}
#chartContainer {
  width: 90%;
  margin: 20px auto;
  display: none;
}
canvas {
  background: #111;
  border-radius: 10px;
}
</style>
</head>
<body>
<div class="container">
  <h1>üèãÔ∏è‚Äç‚ôÇÔ∏è RipFit / FutureBody 3.0</h1>

  <div id="energyBarContainer">
    <div id="energyBar"></div>
    <div id="snack" onclick="eatSnack()">üç´</div>
  </div>
  <p id="energyText">‚ö° Energy: 60%</p>
  <p id="feedback">Let's start strong!</p>

  <div id="avatarContainer">
    <img id="avatar" src="images/body.png" alt="Anatomical body" />

    <!-- Muscle Click Areas -->
    <div class="area" id="chest" style="top:120px;left:125px;width:50px;height:40px;"></div>
    <div class="area" id="biceps" style="top:140px;left:80px;width:40px;height:60px;"></div>
    <div class="area" id="abs" style="top:180px;left:130px;width:40px;height:60px;"></div>
    <div class="area" id="shoulders" style="top:100px;left:110px;width:70px;height:40px;"></div>
    <div class="area" id="legs" style="top:250px;left:125px;width:60px;height:90px;"></div>
  </div>

  <div>
    <button onclick="startDay()">Start Day</button>
    <button onclick="finalizeDay()">Finalize Day</button>
    <button onclick="toggleChart()">üìà Progress</button>
  </div>

  <div id="popup"></div>
  <div id="chartContainer"><canvas id="growthChart" height="200"></canvas></div>
</div>

<script>
const muscles = ["chest", "biceps", "abs", "shoulders", "legs"];
let data = JSON.parse(localStorage.getItem("anatomicalMuscles") || "{}");
if (Object.keys(data).length === 0) {
  muscles.forEach(m => data[m] = { size: 10, lastTrained: 0, reps: 0, history: [] });
}
let day = JSON.parse(localStorage.getItem("currentDay") || "1");
let energy = JSON.parse(localStorage.getItem("energyLevel") || "60");
let chart;

document.querySelectorAll(".area").forEach(area => {
  area.addEventListener("click", e => showPopup(e, area.id));
});
renderAvatar();
updateEnergy();

function showPopup(e, m) {
  const popup = document.getElementById("popup");
  popup.style.left = e.pageX + "px";
  popup.style.top = e.pageY + "px";
  popup.innerHTML = `<b>${m.toUpperCase()}</b><br>Reps: ${data[m].reps}<br>
  <button onclick="train('${m}',5)">+ Rep</button>
  <button onclick="train('${m}',-5)">‚Äì Rep</button>`;
  popup.style.display = "block";
}

window.addEventListener("click", e => {
  if (!e.target.closest("#popup") && !e.target.closest(".area")) document.getElementById("popup").style.display = "none";
});

function train(m, val) {
  let growth = 5;
  if (energy < 40) growth *= 0.5;
  else if (energy > 80) growth *= 1.25;
  data[m].size = Math.max(0, Math.min(200, data[m].size + growth));
  data[m].reps = Math.max(0, data[m].reps + val);
  data[m].lastTrained = day;
  pulse(m);
  energy = Math.min(100, energy + 2);
  renderAvatar();
  updateEnergy();
  saveData();
}

function pulse(m) {
  const el = document.getElementById(m);
  el.style.opacity = "0.6";
  setTimeout(() => (el.style.opacity = "0.15"), 400);
}

function renderAvatar() {
  muscles.forEach(m => {
    const s = data[m].size;
    let color = "green";
    if (s > 80) color = "red";
    else if (s > 40) color = "yellow";
    document.getElementById(m).style.backgroundColor = color;
  });
}

function updateEnergy() {
  document.getElementById("energyBar").style.width = energy + "%";
  document.getElementById("energyText").innerText = `‚ö° Energy: ${energy}%`;
  let fb = "üí™ Steady energy!";
  if (energy > 80) fb = "üî• You‚Äôre unstoppable!";
  else if (energy < 40) fb = "ü•± Low energy ‚Äì grab a bar!";
  document.getElementById("feedback").innerText = fb;
}

function eatSnack() {
  energy = Math.min(100, energy + 10);
  document.getElementById("feedback").innerText = "üç´ Sweet recovery boost!";
  // palautetaan v√§rit vihre√§mm√§ksi
  muscles.forEach(m => {
    const el = document.getElementById(m);
    el.style.backgroundColor = "green";
  });
  updateEnergy();
  saveData();
}

function startDay() {
  day++;
  energy = 60;
  saveData();
  updateEnergy();
  alert("New day started! Energy set to 60%.");
}

function finalizeDay() {
  muscles.forEach(m => {
    if (day - data[m].lastTrained > 2) data[m].size *= 0.95;
    data[m].history.push(Math.round(data[m].size));
    if (data[m].history.length > 90) data[m].history.shift();
  });
  energy = Math.max(0, energy - 10);
  saveData();
  renderAvatar();
  updateEnergy();
  alert("Day finalized and progress saved.");
}

function toggleChart() {
  const c = document.getElementById("chartContainer");
  c.style.display = c.style.display === "none" ? "block" : "none";
  if (c.style.display === "block") drawChart();
}

function drawChart() {
  const ctx = document.getElementById("growthChart").getContext("2d");
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: Array.from({ length: Math.max(...muscles.map(m => data[m].history.length)) }, (_, i) => i + 1),
      datasets: muscles.map((m, i) => ({
        label: m,
        data: data[m].history,
        borderColor: ["#00eaff", "#ff0080", "#ffd700", "#00ff88", "#ff6600"][i],
        fill: false
      }))
    },
    options: { scales: { y: { beginAtZero: true, max: 200 } }, plugins: { legend: { labels: { color: "#fff" } } } }
  });
}

function saveData() {
  localStorage.setItem("anatomicalMuscles", JSON.stringify(data));
  localStorage.setItem("currentDay", JSON.stringify(day));
  localStorage.setItem("energyLevel", JSON.stringify(energy));
}
</script>
</body>
</html>
